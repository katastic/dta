
TODO
	- more lighting 
		- (draw "light" tiles with black tiles to support multiple light sources?)
		- draw a single lightmap accumlation buffer then merge with tilemap (need to figure out the right color multipler settings)
	- logger
	- scripting
	- graph
	- snow/rain particles/leaves blowing in wind
	- ??? i just forgot (something with particles?)
	
	+ SAVE second layer to json file
	- BUG: Looks like atlas is still looking at 256 (at least for 2nd layer/upperlayer)
	- CONVERT more names to camelCase.


	+ https://www.allegro.cc/forums/thread/615262
		allegro 5 gouraud shading.. asked by me, in like 2015.\
	
	- does temperature matter/do anything?
		- slower stamina increase?

	--> how do we STRETCH shadows?
		- we might be able to make our own quad deforming function by looking at the gouraud shading function.
		- that's an implementation detail. we still need to know the math of what we want.
		
			x---x		1---2
			|	|		|	|
			|	|		|	|
			x---x		4---3

			- find furthest point away from lightsource, and stretch outward? hmm
			- stretch/project all 4 points away from lightsource, with 'further away' points being streched further? 
				- map out properly on paper









fishing

farming
	farming meta , factorio ish
		multiple water pumps, nutrients
	
	tower defense without tower defense / re-invent this somehow?


we've potentially got multiple separate games here, however, it may be worked around.
	- You could have a farm, and enjoy it.
	- Later you can go [robbing] at will, even while shopping you may see [robbing] opportunities.
	as long as we're not turning this into a mafia / city simulator, you can remain autonomous.
	
	maybe you save up, fight off smaller dukes/lords/whatever and their goons and thats Chapter 2/3/4/...
	with the final battle involving taking down the king.
	
	... and then you become the next corrupt king and the cycle repeats.
	
	Streets of Rogue with robinhood.
	
we want it to change up here and there and not be the same experience however. IT either needs to be a
 long experience, or have variations to try it differnet ways (ala streets of rogue).

are we combining this with GTA/Robinhood?
 - hire dudes (can they resurrect so you don't feel like they're a waste?)
	- classic buddy problem. AI too good, they play for you. AI too bad, they suck and are useless. And, that 'skill' can change as a player grows.
	- could think of them as powerups. Nobody complains that powerups exist, can be used at will, and end after a set time/damage. (a shield. star power, etc.)
 - 
 
different dudes
	- gladiator/warrior with big shield
	- pikeman/spearman
	- archers
	- mages?
	- clerics?
	- PEASANTS. all they do is run up and punch/beatdown (which can stunlock?) like a jojo reference.

can we outfit our dudes with better equipment?

equipment:
	- chest armor, bracers, helmet, pants
	- weapons
	- charms/magic items / amulets / rings

	
what kind of limiter on max team size do we use?
 - 4/6/8/12/16 dudes?


can we use food/potions during battle to heal? Or more a slow burn after surviving. We don not want potion spam.

how is combat? Kind of like Secret of Mana with a shield blocking ability and dodge?


horse carriages like APC's

 friendly?
 
 also attacking enemy convoys like Far Cry and they all pop out and fight. Finally miniboss emerges as end.
	- plan to choose best place for attacking a convoy based on its type. high ground archers against convoy type [X]



	Look at bosses from METAL SLUG etc

	maps are mostly hand made. maybe we can cookie-cutter them like Diablo. 
	We could add "themes" / mutators to existing map areas. 
		Long path + [Undead] modifier + [High level] modifier
		
	weather effects? not just pretty. like magica: 
		- RAIN has modifiers
			- Platemail lower resist to lightning (both natural and magic)
		- snow?

	Moves:
		- Walk
		- Sprint
		- Dodge 
		- Jump/Leap forward (dodge when not pressing a direction is also jump?)
		- Block
		- Attack [different attack types?]
		- Cast magic
		- Use item
		- Use inventory

		-> Do we have STAMINA? Secret of Mana charge up attacks? Or reducing stamina like more 
		modern games
		-> Can you HOLD attack to do something different than pressing? (like SOM)

	[magic]
		 in SoM each magic type has a "mana spirit" and a series of spells associated with that spirit. kind a neat way
		 to do it other than the tried-and-old "light/dark/fire/water/lightning" by putting a face on that spirit.

	We could basically be fighting all the KNIGHTS of King Arthur as well as MERLIN (and his associates/underlings)
	
		https://en.wikipedia.org/wiki/Knights_of_the_Round_Table
		holy shit theres TONS OF THESE GUYS
			Lancelot - Uses lance?
			
-->		KILL THE LADY OF THE LAKE.
		
	[KNIGHTS OF THE ROUND]
		Yvain - has a pet LION
		

	[ENEMY attacks]
		- Standard: 
			- Stabbing spear
			- Swinging sword
			- Vertical hammer [basically same as spear but no long zone].
			- Shield bash [no to light damage, pushes you back, maybe stuns]
			- Charges up to do one of these ^	
	
		- Think [Vampire Survivors] but the enemy has the weapons]
		- TOUCH: Touching the enemy does damage
		- THORNS: Attacking the enemy with melee does damage
		- AURA: Getting within a radius does damage.
		- WAVE: Wave of fire, wave of rocks, whatever. Straight line wave attack.
		- CIRCLE: radiating circle that spins out.
		- METEOR: A blast hits the ground in a random spot, like a meteor
		- BEAM:  long beams from the enemy or outside the enemy
		- OFF-SCREEN-BASED a wave/line that goes from the outside of the world inward [left of screen to right].
		- floor damage: (like meteor) but could last longer / permenant. Like the sections of Eye boss in Heroes of hammerwatch.
		- Big "run away" boss that is eating. Screen wide, inside a canyon.
	
		- At one point you GO INSIDE A DUNE WORM and fight through the other things its eaten (like other guys/knights/enemies)
		- Boss that runs at you. Whether it's a RAM or a lanceelot horse.
		- Bosses that are mobile and jump away into distinct sections.
		- Send "spikes" from the ground upward [see meteor]
		- Bosses that raise undead
		- BIG BOSSES that have TARGETABLE LIMBS [just like SOM, SOE, CTrigger] for different strategies
			- healer drones
			- maybe not make a single meta the only meta ['always target the drones first']
		- Large mechanical device boss [dwarven?]
		- Dragon(s)
		- A tiny rabbit
		- "sadness" [earthbound] "I'm attacking the darkness!"
		
		- MULTI WEAPON boss puzzles (better make weapon swapping easy then! L/R on controller)
			- e.g. "use whip to get on top of mechanical boss, then use spear weapon to attack through armor plate"
			- Support putting only specific weapons on the quick bar (even if you have more)
				- that is: ready the 3 weapons you care about while still carrying the rest.
	
		- buddies with special attacks:
			- Birds that just attack
			- Birds that flock during an attack phase and then swarm at the player from one side
			 to another.

		- Arrows. Slightly/heavily magically enhanced tracking arrows.

		- A line extends out and rotates (Binding of Isaac 'It Lives!')
		- See [Heroes of Hammerwatch] bosses/enemies

	[weapons]
		- sword [+ shield]
		- two handed sword [longer reach more damage, harder block, slower]
		- whip? boomerang? bow?
		- magic? Make magic available for everyone so there's no 'mage' class. Just paladins. Warriors with small amounts of magic.
		- robinhoodian quartar staff?

	[armor]
		- wear robes to reduce water damage to armor? 
		- change robes to hide identity from [[COPS]]?
		- benefits of light vs heavy armor? Easier dodge for more blocking?

	[attack caravans]
		- dudes outside
		- new guys spilling out (and/or reinforcements offscreen if you take too long)
		- miniboss 'hero' with magic attacks

	[attack other things?]
		[travelling merchants that aren't caravans?]
		[tiers of caravans based on defenses]
		- 1 dude alone [occasionally a rare/legendary, miniboss dude walking by himself. DARE YE TEMPT FATE?]
		- 2 dudes
		- 3 dudes
		- 4 dudes
		- 5 dudes
		- 1 wagon alone
		- 1 wagon + X footmen
		- 1 wagon + X mounted knights
		- 2 wagons + ???
		The more wagons you hit, the more the POLICE (I mean sheriffs guards) will be after you!

		
	defend caravans? annoying? can you send your own caravans to do stuff? can rival players attack them?
		- RIVAL gangs. not just coop but verses?
		
	 - we could have "pets" that help fight but if you have say a dog, people will have their dog die.
	 - also units don't die but go unconscious so you're not starting leveling your dudes everytime
	 - 	also if we're talking VERSES gameplay, we don't want the game to be a "grind to outlevel the
	 enemy because the first time you lose then the other player has more XP/resources forever
	  and its over."

	Secret of Mana
	Chrono Trigger
		- Most level data is either a level warp [house, map edge trigger],
			a solid, or passable terrain plus a list of enemies (that respawn if offscreen)
		- occasional script triggers [just simple lua stuff for us]
		
		- units walking around, for towns:
			- isFriendly/isNeutral = true;
			- hasScript = true; 
			- runs luascript for onUse/onTalk();  and optionally onAttack();
		
		- MAP LAYERS
			- ground
			- tree / overhang layer
		
		- Sellers/dealers (the cat dude)
		- Houses
		




the problem with horses
	while we can have NPC horses. if we give players horses then now there's two game modes. 
		- Fast running on a horse and you have to jump off to fight. [travel horses now its just a hassle]
		- Can fight while on horse in which case you'll never NOT use horses again [always horses makes non-horses a permenant early game transition]

TODO - 
	add diagonal detection
	also decide whether diagonal should be proper sqrt(2) or classic wrong faster.

dudes
	- animation handler, script files.
	- more FSM stuff
	- are items separate from sprites? Then we'll need an anchor point for each sprite cell
		for the sword location and (if applicable) rotation angle
	
map
	- tileset/texture atlas parser
	- map editor

particles
	- sword attack

player finite state machine! DRAW THIS THING.

	walking - free movement
	jumping - in air jumping
		- Can jumping be interrupted???
	
	landing - delay after hitting ground 'blade landing'
	
	stunned - can't move. (also can't be hurt?)
			<-- I think in Secret of Mana, you get hit for a moment, immortal. But then you are still immortal for another second or two while walking/attacking.
				- so the key here is INVULERABILITY_TIMER gets set upon being STUNNED (edge trigger) but keeps ticking down after STUN_TIMER runs out. So 
				invulnerability is not tied to state transitions out.
	attacking?
		- "windup animation for attack"  Animation: yes. Otherwise ??? (ala can it be canceled)

	casting?
		- in secret of mana casting has a windup animation but also you can't be hit but... hits attacks can be queued up on you
			ANIMATION: yes. Whether it controls immortality or anything is a ???.
		- more or less just attack 
	
	parry?
		- can we parry? (I think in SoM if both attacks hit at same time they don't subtract stamina and both get attackers attacks get reset)
		- parry could be a very short stun duration with no invulnerability
		
	dodge/roll? [more or less a jump with different animation?]
		-
		-

dlang wtfs:
	- use max! maxElement! all these great library functions! Just kidding. They don't work with static arrays. When is it a static vs dynamic array? Maybe as little as 1 character difference in the declaration.
	- foreach copies BY VALUE by default?! So every time you don't do foreach(ref) you're actually wasting the entire point of using reference types everywhere.
		- wait, but there are places where i didn't use foreach(ref) and it still set the values? How?
	
	http://ddili.org/ders/d.en/foreach_opapply.html
	
	
	- toString works great. Until you want as simple a thing as myfloat.toString which doesn't exist??? (I get you can format floats differently but what if you just want to dump it into a string for debugging? Time to bustout std.format("%s",myFloat), so elegant!)
	- don't forget that using writeln in a Deconstructor might incur a garbage collection and crash the garbage collector.
	- RAII doesn't reliably exist. (WTF?)
	- 'private' doesn't do anything like C++. It's private "to the module" not to the class. So literally ALL MEMBERS ARE PUBLIC inside a module. Yeah, let's make a nice statically typed language with access specifiers to ensure proper programming. Oh, and also, everyone can access literally anything. Because fuck you.
	
